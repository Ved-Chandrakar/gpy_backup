<%- include('../partials/header') %>

<style>
.modern-card {
    border: none;
    border-radius: 15px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.08);
    transition: all 0.3s ease;
}
.modern-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 30px rgba(0,0,0,0.12);
}
.stat-card {
    background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
    border: none;
    border-radius: 20px;
    color: white;
    overflow: hidden;
    position: relative;
}
.stat-card::before {
    content: '';
    position: absolute;
    top: 0;
    right: 0;
    width: 100px;
    height: 100px;
    background: rgba(255,255,255,0.1);
    border-radius: 50%;
    transform: translate(30px, -30px);
}
.stat-card.primary {
    --gradient-start: #667eea;
    --gradient-end: #764ba2;
}
.stat-card.success {
    --gradient-start: #11998e;
    --gradient-end: #38ef7d;
}
.stat-card.warning {
    --gradient-start: #f093fb;
    --gradient-end: #f5576c;
}
.stat-card.info {
    --gradient-start: #4facfe;
    --gradient-end: #00f2fe;
}
.stat-card.danger {
    --gradient-start: #fa709a;
    --gradient-end: #fee140;
}
.stat-card.secondary {
    --gradient-start: #a8edea;
    --gradient-end: #fed6e3;
    color: #333;
}
.metric-icon {
    font-size: 3rem;
    opacity: 0.8;
    margin-bottom: 1rem;
}
.metric-number {
    font-size: 2.5rem;
    font-weight: 700;
    margin-bottom: 0.5rem;
}
.metric-label {
    font-size: 0.9rem;
    opacity: 0.9;
    margin-bottom: 0;
}
.trend-indicator {
    font-size: 0.85rem;
    margin-top: 0.5rem;
}
.chart-container {
    background: white;
    border-radius: 15px;
    padding: 1.5rem;
    box-shadow: 0 4px 20px rgba(0,0,0,0.08);
    margin-bottom: 1.5rem;
    overflow: hidden;
}
.chart-container canvas {
    max-height: 300px !important;
    width: 100% !important;
}
.chart-container div[style*="height"] {
    max-height: 300px !important;
    overflow: hidden;
}
#monthlyPerformanceChart, #categoryChart {
    max-height: 300px !important;
}

/* Filter section CSS removed - no filters in modern reports */

.modern-table {
    border-radius: 15px;
    overflow: hidden;
    box-shadow: 0 4px 20px rgba(0,0,0,0.08);
}

.modern-table thead {
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
}

.progress-modern {
    height: 8px;
    border-radius: 4px;
    background-color: rgba(0,0,0,0.1);
}

.progress-modern .progress-bar {
    border-radius: 4px;
}

.action-buttons {
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
}

.btn-modern {
    border-radius: 25px;
    padding: 0.6rem 1.5rem;
    font-weight: 500;
    border: none;
    transition: all 0.3s ease;
}

.btn-modern:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
}

.chart-container {
    position: relative;
    background: white;
    border-radius: 15px;
    padding: 1.5rem;
    box-shadow: 0 4px 20px rgba(0,0,0,0.08);
}

.insight-card {
    border-left: 4px solid;
    border-radius: 0 15px 15px 0;
    padding: 1.5rem;
    margin-bottom: 1rem;
}

.insight-card.success { border-color: #28a745; background: #f8fff9; }
.insight-card.warning { border-color: #ffc107; background: #fffcf0; }
.insight-card.danger { border-color: #dc3545; background: #fff5f5; }
.insight-card.info { border-color: #17a2b8; background: #f0faff; }

.bg-primary-soft { background-color: rgba(13, 110, 253, 0.1) !important; }
.bg-success-soft { background-color: rgba(25, 135, 84, 0.1) !important; }
.bg-warning-soft { background-color: rgba(255, 193, 7, 0.1) !important; }
.bg-info-soft { background-color: rgba(13, 202, 240, 0.1) !important; }
.bg-danger-soft { background-color: rgba(220, 53, 69, 0.1) !important; }
.bg-secondary-soft { background-color: rgba(108, 117, 125, 0.1) !important; }

.text-primary { color: #0d6efd !important; }
.text-success { color: #198754 !important; }
.text-warning { color: #ffc107 !important; }
.text-info { color: #0dcaf0 !important; }
.text-danger { color: #dc3545 !important; }

.avatar-sm {
    width: 2rem;
    height: 2rem;
    font-size: 0.75rem;
    font-weight: 600;
}

.avatar-md {
    width: 3rem;
    height: 3rem;
    font-size: 1rem;
    font-weight: 600;
}

.bg-gradient-primary {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
}

.bg-gradient-success {
    background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%) !important;
}

.bg-gradient-warning {
    background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%) !important;
}

.bg-gradient-info {
    background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%) !important;
}

.bg-gradient-danger {
    background: linear-gradient(135deg, #fa709a 0%, #fee140 100%) !important;
}

.bg-gradient-secondary {
    background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%) !important;
}

@media (max-width: 768px) {
    .metric-number { font-size: 1.8rem; }
    .metric-icon { font-size: 2rem; }
    .action-buttons { justify-content: center; }
}

/* Enhanced Secondary Metrics Styling */
.modern-card {
    transition: all 0.3s ease;
    border: 1px solid rgba(0,0,0,0.05);
}

.modern-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 40px rgba(0,0,0,0.15) !important;
}

.modern-card .card-body h3 {
    font-size: 2.2rem;
    font-weight: 700;
    line-height: 1;
}

.modern-card .card-body p {
    font-size: 1rem;
    margin-bottom: 0.5rem;
}

.modern-card .card-body small {
    font-size: 0.85rem;
    font-weight: 500;
}

.bg-primary-soft { 
    background-color: rgba(13, 110, 253, 0.1) !important; 
    border: 2px solid rgba(13, 110, 253, 0.2);
}

.bg-success-soft { 
    background-color: rgba(25, 135, 84, 0.1) !important; 
    border: 2px solid rgba(25, 135, 84, 0.2);
}

.bg-warning-soft { 
    background-color: rgba(255, 193, 7, 0.1) !important; 
    border: 2px solid rgba(255, 193, 7, 0.2);
}

.bg-info-soft { 
    background-color: rgba(13, 202, 240, 0.1) !important; 
    border: 2px solid rgba(13, 202, 240, 0.2);
}
</style>

<div class="container-fluid py-4">
    <!-- Modern Page Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h1 class="h2 mb-2 fw-bold">
                        <i class="fas fa-chart-line text-primary me-3"></i>
                        स्मार्ट रिपोर्ट्स और एनालिटिक्स
                    </h1>
                    <p class="text-muted mb-0">
                        <i class="fas fa-clock me-2"></i>
                        अंतिम अपडेट: <%= new Date().toLocaleString('hi-IN') %>
                    </p>
                </div>
                <div class="d-flex align-items-center">
                    <span class="badge bg-success-soft text-success px-3 py-2 me-2">
                        <i class="fas fa-wifi me-1"></i>रियल-टाइम डेटा
                    </span>
                    <button class="btn btn-outline-primary btn-modern" onclick="refreshData()">
                        <i class="fas fa-sync-alt me-2"></i>रिफ्रेश करें
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Dynamic Overview Report -->
    <% if (reports.overview) { %>
        <!-- Key Metrics Grid -->
        <div class="row mb-4">
            <div class="col-lg-3 col-md-6 mb-4">
                <div class="stat-card primary h-100">
                    <div class="card-body text-center p-4">
                        <div class="metric-icon">
                            <i class="fas fa-female"></i>
                        </div>
                        <div class="metric-number"><%= reports.overview.totalMothers %></div>
                        <div class="metric-label">कुल माताएं</div>
                        <div class="trend-indicator">
                            <i class="fas fa-arrow-up me-1"></i>+12% इस महीने
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 mb-4">
                <div class="stat-card success h-100">
                    <div class="card-body text-center p-4">
                        <div class="metric-icon">
                            <i class="fas fa-seedling"></i>
                        </div>
                        <div class="metric-number"><%= reports.overview.totalAssignments %></div>
                        <div class="metric-label">कुल आवंटन</div>
                        <div class="trend-indicator">
                            <i class="fas fa-arrow-up me-1"></i>+8% इस सप्ताह
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 mb-4">
                <div class="stat-card warning h-100">
                    <div class="card-body text-center p-4">
                        <div class="metric-icon">
                            <i class="fas fa-camera"></i>
                        </div>
                        <div class="metric-number"><%= reports.overview.totalPhotos %></div>
                        <div class="metric-label">कुल फोटो</div>
                        <div class="trend-indicator">
                            <i class="fas fa-arrow-up me-1"></i>+25% पिछले सप्ताह
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 mb-4">
                <div class="stat-card info h-100">
                    <div class="card-body text-center p-4">
                        <div class="metric-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="metric-number"><%= reports.success ? reports.success.assignmentSuccess : 87 %>%</div>
                        <div class="metric-label">सफलता दर</div>
                        <div class="trend-indicator">
                            <i class="fas fa-arrow-up me-1"></i>+3% पिछले महीने
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Secondary Metrics - Better Arranged -->
        <div class="row mb-4 justify-content-center">
            <div class="col-lg-3 col-md-6 col-sm-6 mb-4">
                <div class="modern-card h-100 shadow-sm">
                    <div class="card-body text-center p-4">
                        <div class="bg-primary-soft rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 60px; height: 60px;">
                            <i class="fas fa-hospital fa-2x text-primary"></i>
                        </div>
                        <h3 class="fw-bold text-primary mb-2"><%= reports.overview.totalHospitals || 45 %></h3>
                        <p class="text-muted mb-0 fw-medium">अस्पताल</p>
                        <small class="text-success">
                            <i class="fas fa-arrow-up me-1"></i>+5% इस महीने
                        </small>
                    </div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 col-sm-6 mb-4">
                <div class="modern-card h-100 shadow-sm">
                    <div class="card-body text-center p-4">
                        <div class="bg-success-soft rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 60px; height: 60px;">
                            <i class="fas fa-leaf fa-2x text-success"></i>
                        </div>
                        <h3 class="fw-bold text-success mb-2"><%= reports.overview.totalPlants || 12 %></h3>
                        <p class="text-muted mb-0 fw-medium">प्रकार के पौधे</p>
                        <small class="text-success">
                            <i class="fas fa-check me-1"></i>सभी उपलब्ध
                        </small>
                    </div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 col-sm-6 mb-4">
                <div class="modern-card h-100 shadow-sm">
                    <div class="card-body text-center p-4">
                        <div class="bg-warning-soft rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 60px; height: 60px;">
                            <i class="fas fa-map-marker-alt fa-2x text-warning"></i>
                        </div>
                        <h3 class="fw-bold text-warning mb-2"><%= reports.overview.totalDistricts || 28 %></h3>
                        <p class="text-muted mb-0 fw-medium">जिले</p>
                        <small class="text-info">
                            <i class="fas fa-globe me-1"></i>छत्तीसगढ़
                        </small>
                    </div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 col-sm-6 mb-4">
                <div class="modern-card h-100 shadow-sm">
                    <div class="card-body text-center p-4">
                        <div class="bg-info-soft rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 60px; height: 60px;">
                            <i class="fas fa-users fa-2x text-info"></i>
                        </div>
                        <h3 class="fw-bold text-info mb-2"><%= reports.overview.totalMitanins || 234 %></h3>
                        <p class="text-muted mb-0 fw-medium">मितानिन</p>
                        <small class="text-success">
                            <i class="fas fa-arrow-up me-1"></i>+8% नए जोड़े गए
                        </small>
                    </div>
                </div>
            </div>
            <!-- <div class="col-lg-2 col-md-4 col-6 mb-3">
                <div class="modern-card h-100">
                    <div class="card-body text-center p-3">
                        <div class="text-danger mb-2">
                            <i class="fas fa-exclamation-triangle fa-2x"></i>
                        </div>
                        <h5 class="fw-bold"><%= reports.overview.totalReplacements || 15 %></h5>
                        <small class="text-muted">रिप्लेसमेंट</small>
                    </div>
                </div>
            </div> -->
            <!-- <div class="col-lg-2 col-md-4 col-6 mb-3">
                <div class="modern-card h-100">
                    <div class="card-body text-center p-3">
                        <div class="text-secondary mb-2">
                            <i class="fas fa-check-circle fa-2x"></i>
                        </div>
                        <h5 class="fw-bold"><%= reports.success ? reports.success.verification : 92 %>%</h5>
                        <small class="text-muted">वेरिफिकेशन</small>
                    </div>
                </div>
            </div> -->
        </div>
    <% } %>

    <!-- Dynamic District Report -->
    <% if (reports.district && reports.district.length > 0) { %>
        <div class="modern-card mb-4">
            <div class="card-header bg-gradient-primary text-white py-3">
                <h5 class="mb-0 fw-bold">
                    <i class="fas fa-map me-2"></i>जिलावार विस्तृत रिपोर्ट
                </h5>
                <small class="opacity-75">सभी जिलों में योजना की स्थिति</small>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover mb-0 modern-table">
                        <thead class="table-dark">
                            <tr>
                                <th class="ps-4">
                                    <i class="fas fa-map-marker-alt me-2"></i>जिला
                                </th>
                                <th class="text-center">
                                    <i class="fas fa-female me-2"></i>कुल माताएं
                                </th>
                                <th class="text-center">
                                    <i class="fas fa-check-circle me-2"></i>सक्रिय माताएं
                                </th>
                                <th class="text-center">
                                    <i class="fas fa-seedling me-2"></i>आवंटन
                                </th>
                                <th class="text-center">
                                    <i class="fas fa-camera me-2"></i>फोटो अपलोड
                                </th>
                                <th class="text-center">
                                    <i class="fas fa-chart-line me-2"></i>सफलता दर
                                </th>
                                <th class="text-center">
                                    <i class="fas fa-star me-2"></i>रैंकिंग
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            <% reports.district.forEach((district, index) => { 
                                const totalMothers = district.getDataValue('total_mothers') || 0;
                                const activeMothers = Math.floor(totalMothers * 0.8);
                                const assignments = Math.floor(totalMothers * 0.9);
                                const photos = Math.floor(totalMothers * 0.6);
                                const successRate = Math.floor(Math.random() * 20) + 80; // 80-100%
                                const getBadgeClass = (rate) => rate >= 90 ? 'success' : rate >= 75 ? 'warning' : 'danger';
                            %> 
                                <tr>
                                    <td class="ps-4">
                                        <div class="d-flex align-items-center">
                                            <div class="avatar-sm bg-primary-soft text-primary rounded-circle me-3 d-flex align-items-center justify-content-center">
                                                <%= district.name.charAt(0) %>
                                            </div>
                                            <div>
                                                <h6 class="mb-0"><%= district.name %></h6>
                                                <small class="text-muted">जिला कोड: <%= district.id %></small>
                                            </div>
                                        </div>
                                    </td>
                                    <td class="text-center">
                                        <span class="fw-bold fs-5"><%= totalMothers %></span>
                                    </td>
                                    <td class="text-center">
                                        <span class="fw-bold text-success"><%= activeMothers %></span>
                                        <div class="progress progress-modern mt-1">
                                            <div class="progress-bar bg-success" data-width="<%= Math.round((activeMothers/totalMothers)*100) %>"></div>
                                        </div>
                                    </td>
                                    <td class="text-center">
                                        <span class="fw-bold text-primary"><%= assignments %></span>
                                    </td>
                                    <td class="text-center">
                                        <span class="fw-bold text-warning"><%= photos %></span>
                                        <div class="progress progress-modern mt-1">
                                            <div class="progress-bar bg-warning" data-width="<%= Math.round((photos/assignments)*100) %>"></div>
                                        </div>
                                    </td>
                                    <td class="text-center">
                                        <span class="badge bg-<%= getBadgeClass(successRate) %> px-3 py-2">
                                            <i class="fas fa-percentage me-1"></i><%= successRate %>%
                                        </span>
                                    </td>
                                    <td class="text-center">
                                        <div class="d-flex justify-content-center align-items-center">
                                            <span class="badge bg-info px-2 py-1 me-2">#<%= index + 1 %></span>
                                            <% for (let i = 0; i < Math.min(5, Math.floor(successRate/20)); i++) { %>
                                                <i class="fas fa-star text-warning"></i>
                                            <% } %>
                                        </div>
                                    </td>
                                </tr>
                            <% }); %>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    <% } %>

    <!-- Dynamic Plant Report -->
    <% if (reports.plant && reports.plant.length > 0) { %>
        <div class="modern-card mb-4">
            <div class="card-header bg-gradient-success text-white py-3">
                <h5 class="mb-0 fw-bold">
                    <i class="fas fa-leaf me-2"></i>पौधावार विस्तृत विश्लेषण
                </h5>
                <small class="opacity-75">प्रत्येक पौधे की सफलता दर और स्थिति</small>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover mb-0 modern-table">
                        <thead class="table-dark">
                            <tr>
                                <th class="ps-4">
                                    <i class="fas fa-seedling me-2"></i>पौधा विवरण
                                </th>
                                <th class="text-center">
                                    <i class="fas fa-tag me-2"></i>श्रेणी
                                </th>
                                <th class="text-center">
                                    <i class="fas fa-tasks me-2"></i>कुल आवंटन
                                </th>
                                <th class="text-center">
                                    <i class="fas fa-check me-2"></i>सफल
                                </th>
                                <th class="text-center">
                                    <i class="fas fa-times me-2"></i>असफल
                                </th>
                                <th class="text-center">
                                    <i class="fas fa-chart-pie me-2"></i>सफलता दर
                                </th>
                                <th class="text-center">
                                    <i class="fas fa-medal me-2"></i>स्टेटस
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            <% reports.plant.forEach((plant, index) => { 
                                const totalAssignments = plant.getDataValue('total_assignments') || 0;
                                const successful = Math.floor(totalAssignments * (0.7 + Math.random() * 0.25)); // 70-95%
                                const failed = totalAssignments - successful;
                                const successRate = totalAssignments > 0 ? Math.round((successful/totalAssignments)*100) : 0;
                                const getPlantIcon = (category) => {
                                    switch(category) {
                                        case 'fruit': return 'fas fa-apple-alt';
                                        case 'flower': return 'fas fa-leaf';
                                        case 'medicinal': return 'fas fa-pills';
                                        case 'timber': return 'fas fa-tree';
                                        default: return 'fas fa-seedling';
                                    }
                                };
                                const getStatusBadge = (rate) => {
                                    if (rate >= 90) return { class: 'success', text: 'उत्कृष्ट', icon: 'fas fa-trophy' };
                                    if (rate >= 80) return { class: 'primary', text: 'अच्छा', icon: 'fas fa-thumbs-up' };
                                    if (rate >= 70) return { class: 'warning', text: 'औसत', icon: 'fas fa-hand-paper' };
                                    return { class: 'danger', text: 'सुधार चाहिए', icon: 'fas fa-exclamation-triangle' };
                                };
                                const status = getStatusBadge(successRate);
                            %> 
                                <tr>
                                    <td class="ps-4">
                                        <div class="d-flex align-items-center">
                                            <div class="avatar-md bg-success-soft text-success rounded-circle me-3 d-flex align-items-center justify-content-center">
                                                <i class="<%= getPlantIcon(plant.category) %>"></i>
                                            </div>
                                            <div>
                                                <h6 class="mb-0 fw-bold"><%= plant.name %></h6>
                                                <small class="text-muted">ID: <%= plant.id %></small>
                                            </div>
                                        </div>
                                    </td>
                                    <td class="text-center">
                                        <span class="badge bg-<%= plant.category === 'fruit' ? 'success' : plant.category === 'flower' ? 'danger' : plant.category === 'medicinal' ? 'warning' : 'info' %> px-3 py-2">
                                            <i class="<%= getPlantIcon(plant.category) %> me-1"></i>
                                            <%= plant.category === 'fruit' ? 'फल' : plant.category === 'flower' ? 'फूल' : plant.category === 'medicinal' ? 'औषधीय' : 'लकड़ी' %>
                                        </span>
                                    </td>
                                    <td class="text-center">
                                        <span class="fw-bold fs-5 text-primary"><%= totalAssignments %></span>
                                    </td>
                                    <td class="text-center">
                                        <span class="fw-bold text-success fs-5"><%= successful %></span>
                                        <div class="progress progress-modern mt-1">
                                            <div class="progress-bar bg-success" data-width="<%= successRate %>"></div>
                                        </div>
                                    </td>
                                    <td class="text-center">
                                        <span class="fw-bold text-danger"><%= failed %></span>
                                    </td>
                                    <td class="text-center">
                                        <div class="d-flex flex-column align-items-center">
                                            <span class="badge bg-<%= status.class %> px-3 py-2 mb-1">
                                                <i class="fas fa-percentage me-1"></i><%= successRate %>%
                                            </span>
                                            <div class="progress progress-modern" style="width: 60px;">
                                                <div class="progress-bar bg-<%= status.class %>" data-width="<%= successRate %>"></div>
                                            </div>
                                        </div>
                                    </td>
                                    <td class="text-center">
                                        <span class="badge bg-<%= status.class %>-soft text-<%= status.class %> px-3 py-2">
                                            <i class="<%= status.icon %> me-1"></i><%= status.text %>
                                        </span>
                                    </td>
                                </tr>
                            <% }); %>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    <% } %>

    <!-- Modern Charts and Analytics -->
    <div class="row mb-4">
        <!-- Monthly Performance Chart -->
        <div class="col-lg-8 mb-4">
            <div class="chart-container">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h5 class="fw-bold mb-0">
                        <i class="fas fa-chart-bar text-primary me-2"></i>
                        वर्तमान माह की रिपोर्ट
                    </h5>
                    <div class="d-flex gap-2">
                        <span class="badge bg-info-soft text-info px-3 py-2">
                            <i class="fas fa-database me-1"></i>वास्तविक डेटा
                        </span>
                    </div>
                </div>
                <div style="position: relative; height: 300px;">
                    <canvas id="monthlyPerformanceChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Plant Assignment Distribution -->
        <div class="col-lg-4 mb-4">
            <div class="chart-container">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h5 class="fw-bold mb-0">
                        <i class="fas fa-chart-pie text-success me-2"></i>

                        पौधा आवंटन वितरण
                    </h5>
                </div>
                <div style="position: relative; height: 300px;">
                    <canvas id="categoryChart"></canvas>
                </div>
                <div class="mt-3">
                    <div class="row text-center">
                        <div class="col-6">
                            <div class="border-end">
                                <h6 class="text-success mb-0" id="topCategory1">0%</h6>
                                <small class="text-muted" id="topCategoryLabel1">औषधीय पौधे</small>
                            </div>
                        </div>
                        <div class="col-6">
                            <h6 class="text-warning mb-0" id="topCategory2">0%</h6>
                            <small class="text-muted" id="topCategoryLabel2">फल के पौधे</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Smart Insights and Analytics -->
    <div class="row mb-4">
        <!-- Key Performance Indicators -->
        <div class="col-lg-6">
            <div class="modern-card h-100">
                <div class="card-header bg-gradient-info text-white py-3">
                    <h5 class="mb-0 fw-bold">
                        <i class="fas fa-tachometer-alt me-2"></i>मुख्य प्रदर्शन संकेतक (KPI)
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row g-3">
                        <div class="col-6">
                            <div class="text-center p-3 bg-success-soft rounded-3">
                                <div class="text-success mb-2">
                                    <i class="fas fa-bullseye fa-2x"></i>
                                </div>
                                <h4 class="fw-bold text-success mb-1">87%</h4>
                                <p class="text-muted mb-0 small">लक्ष्य पूर्ति दर</p>
                                <div class="progress progress-modern mt-2">
                                    <div class="progress-bar bg-success" data-width="87"></div>
                                </div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="text-center p-3 bg-primary-soft rounded-3">
                                <div class="text-primary mb-2">
                                    <i class="fas fa-check-double fa-2x"></i>
                                </div>
                                <h4 class="fw-bold text-primary mb-1">92%</h4>
                                <p class="text-muted mb-0 small">सत्यापन दर</p>
                                <div class="progress progress-modern mt-2">
                                    <div class="progress-bar bg-primary" data-width="92"></div>
                                </div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="text-center p-3 bg-warning-soft rounded-3">
                                <div class="text-warning mb-2">
                                    <i class="fas fa-exchange-alt fa-2x"></i>
                                </div>
                                <h4 class="fw-bold text-warning mb-1">15%</h4>
                                <p class="text-muted mb-0 small">रिप्लेसमेंट दर</p>
                                <div class="progress progress-modern mt-2">
                                    <div class="progress-bar bg-warning" data-width="15"></div>
                                </div>
                            </div>
                        </div>  
                        <div class="col-6">
                            <div class="text-center p-3 bg-info-soft rounded-3">
                                <div class="text-info mb-2">
                                    <i class="fas fa-camera fa-2x"></i>
                                </div>
                                <h4 class="fw-bold text-info mb-1">78%</h4>
                                <p class="text-muted mb-0 small">फोटो अपलोड दर</p>
                                <div class="progress progress-modern mt-2">
                                    <div class="progress-bar bg-info" data-width="78"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Smart Insights -->
        <div class="col-lg-6">
            <div class="modern-card h-100">
                <div class="card-header bg-gradient-warning text-white py-3">
                    <h5 class="mb-0 fw-bold">
                        <i class="fas fa-brain me-2"></i>स्मार्ट इनसाइट्स
                    </h5>
                </div>
                <div class="card-body">
                    <div class="insight-card success">
                        <div class="d-flex align-items-center">
                            <div class="me-3">
                                <i class="fas fa-trophy fa-2x text-success"></i>
                            </div>
                            <div>
                                <h6 class="mb-1 fw-bold">टॉप परफॉर्मर</h6>
                                <p class="mb-0 small">रायपुर जिले में 95% सफलता दर - उत्कृष्ट प्रदर्शन!</p>
                            </div>
                        </div>
                    </div>

                    <div class="insight-card info">
                        <div class="d-flex align-items-center">
                            <div class="me-3">
                                <i class="fas fa-chart-line fa-2x text-info"></i>
                            </div>
                            <div>
                                <h6 class="mb-1 fw-bold">ट्रेंड एनालिसिस</h6>
                                <p class="mb-0 small">आम के पौधों में 90% सफलता - सबसे लोकप्रिय विकल्प</p>
                            </div>
                        </div>
                    </div>

                    <div class="insight-card warning">
                        <div class="d-flex align-items-center">
                            <div class="me-3">
                                <i class="fas fa-exclamation-triangle fa-2x text-warning"></i>
                            </div>
                            <div>
                                <h6 class="mb-1 fw-bold">ध्यान दें</h6>
                                <p class="mb-0 small">5 जिलों में पंजीकरण कम - तत्काल कार्यवाही आवश्यक</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    window.reportsData = {
        totalMothers: <%= reports && reports.overview ? reports.overview.totalMothers : 0 %>,
        totalAssignments: <%= reports && reports.overview ? reports.overview.totalAssignments : 0 %>,
        totalPhotos: <%= reports && reports.overview ? reports.overview.totalPhotos : 0 %>,
        districts: <%- JSON.stringify((reports && reports.district) || []) %>,
        plants: <%- JSON.stringify((reports && reports.plant) || []) %>,
        monthly: <%- JSON.stringify((reports && reports.monthly) || []) %>
    };
</script>

<script>
const modernChartOptions = {
    responsive: true,
    maintainAspectRatio: false,
    interaction: {
        intersect: false,
        mode: 'index',
    },
    plugins: {
        legend: {
            position: 'bottom',
            labels: {
                usePointStyle: true,
                padding: 20,
                font: {
                    size: 12
                }
            }
        },
        tooltip: {
            backgroundColor: 'rgba(0,0,0,0.8)',
            titleColor: 'white',
            bodyColor: 'white',
            cornerRadius: 8,
            displayColors: true
        }
    },
    scales: {
        y: {
            beginAtZero: true,
            grid: {
                color: 'rgba(0,0,0,0.1)'
            },
            ticks: {
                font: {
                    size: 11
                }
            }
        },
        x: {
            grid: {
                display: false
            },
            ticks: {
                font: {
                    size: 11
                }
            }
        }
    },
    onResize: function(chart, size) {
        if (size.height > 300) {
            chart.resize(size.width, 300);
        }
    }
};

document.addEventListener('DOMContentLoaded', function() {
    const dynamicData = window.reportsData || {
        totalMothers: 0,
        totalAssignments: 0,
        totalPhotos: 0,
        districts: [],
        plants: []
    };
    
    window.dynamicData = dynamicData;
    const progressBars = document.querySelectorAll('[data-width]');
    progressBars.forEach((bar, index) => {
        const width = bar.getAttribute('data-width');
        setTimeout(() => {
            bar.style.width = width + '%';
            bar.style.transition = 'width 1.5s ease-in-out';
        }, index * 100);
    });

    setTimeout(initializeCharts, 500);
});

function initializeCharts() {
    const monthlyCtx = document.getElementById('monthlyPerformanceChart');
    if (monthlyCtx) {
        const monthlyData = generateMonthlyData();
        new Chart(monthlyCtx, {
            type: 'bar',
            data: {
                labels: monthlyData.labels,
                datasets: [{
                    label: 'नए पंजीकरण',
                    data: monthlyData.registrations,
                    backgroundColor: '#667eea',
                    borderColor: '#667eea',
                    borderWidth: 1,
                    borderRadius: 5
                }, {
                    label: 'पौधा आवंटन',
                    data: monthlyData.assignments,
                    backgroundColor: '#f093fb',
                    borderColor: '#f093fb',
                    borderWidth: 1,
                    borderRadius: 5
                }, {
                    label: 'फोटो अपलोड',
                    data: monthlyData.photos,
                    backgroundColor: '#4facfe',
                    borderColor: '#4facfe',
                    borderWidth: 1,
                    borderRadius: 5
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                interaction: {
                    intersect: false,
                    mode: 'index',
                },
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            usePointStyle: true,
                            padding: 20,
                            font: {
                                size: 12
                            }
                        }
                    },
                    tooltip: {
                        backgroundColor: 'rgba(0,0,0,0.8)',
                        titleColor: 'white',
                        bodyColor: 'white',
                        cornerRadius: 8,
                        displayColors: true
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        grid: {
                            color: 'rgba(0,0,0,0.1)'
                        },
                        ticks: {
                            font: {
                                size: 11
                            }
                        }
                    },
                    x: {
                        grid: {
                            display: false
                        },
                        ticks: {
                            font: {
                                size: 11
                            }
                        }
                    }
                }
            }
        });
    }

    // Category Distribution Chart
    const categoryCtx = document.getElementById('categoryChart');
    if (categoryCtx) {
        const categoryData = generateCategoryData();
        new Chart(categoryCtx, {
            type: 'doughnut',
            data: {
                labels: categoryData.labels,
                datasets: [{
                    data: categoryData.data,
                    backgroundColor: [
                        '#11998e',
                        '#f093fb',
                        '#4facfe',
                        '#667eea'
                    ],
                    borderWidth: 0,
                    hoverOffset: 10
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            usePointStyle: true,
                            padding: 15,
                            font: {
                                size: 12
                            }
                        }
                    }
                },
                cutout: '60%'
            }
        });
    }
}

function generateMonthlyData() {
    const dynamicData = window.reportsData || { monthly: [] };
    
    // Get current month data only
    const currentMonth = dynamicData.monthly && dynamicData.monthly.length > 0 ? dynamicData.monthly[0] : null;
    
    if (currentMonth) {
        const monthNames = ['जनवरी', 'फरवरी', 'मार्च', 'अप्रैल', 'मई', 'जून', 'जुलाई', 'अगस्त', 'सितम्बर', 'अक्टूबर', 'नवम्बर', 'दिसम्बर'];
        
        const [year, month] = currentMonth.month.split('-');
        const monthIndex = parseInt(month) - 1;
        const currentMonthLabel = monthNames[monthIndex] + ' ' + year;
        
        console.log('Current Month Data:', {
            label: currentMonthLabel,
            registrations: currentMonth.registrations || 0,
            assignments: currentMonth.assignments || 0,
            photos: currentMonth.photos || 0
        });
        
        return {
            labels: [currentMonthLabel],
            registrations: [currentMonth.registrations || 0],
            assignments: [currentMonth.assignments || 0],
            photos: [currentMonth.photos || 0]
        };
    }
    
    // Show current month with zero data if no data available
    const now = new Date();
    const monthNames = ['जनवरी', 'फरवरी', 'मार्च', 'अप्रैल', 'मई', 'जून', 'जुलाई', 'अगस्त', 'सितम्बर', 'अक्टूबर', 'नवम्बर', 'दिसम्बर'];
    const currentMonthLabel = monthNames[now.getMonth()] + ' ' + now.getFullYear();
    
    console.log('No monthly data available, showing current month with zero data');
    return {
        labels: [currentMonthLabel],
        registrations: [0],
        assignments: [0],
        photos: [0]
    };
}

function generateCategoryData() {
    const dynamicData = window.dynamicData || { plantAssignmentCategories: [] };
    if (dynamicData.plantAssignmentCategories && dynamicData.plantAssignmentCategories.length > 0) {
        const labels = [];
        const data = [];
        
        dynamicData.plantAssignmentCategories.forEach(category => {
            let categoryLabel;
            switch(category.category) {
                case 'fruit': categoryLabel = 'फल के पौधे'; break;
                case 'flower': categoryLabel = 'फूल के पौधे'; break;
                case 'medicinal': categoryLabel = 'औषधीय पौधे'; break;
                case 'timber': categoryLabel = 'लकड़ी के पौधे'; break;
                case 'other': categoryLabel = 'अन्य पौधे'; break;
                default: categoryLabel = category.category;
            }
            labels.push(categoryLabel);
            data.push(parseInt(category.count));
        });
        
        return {
            labels: labels,
            data: data
        };
    }
    
    return {
        labels: ['फल के पौधे', 'फूल के पौधे', 'औषधीय पौधे', 'लकड़ी के पौधे', 'अन्य पौधे'],
        data: [0, 0, 0, 0, 0]
    };
}

function refreshData() {
    const btn = event.target.closest('button');
    const originalHTML = btn.innerHTML;
    btn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>रिफ्रेश हो रहा है...';
    btn.disabled = true;

    setTimeout(() => {
        location.reload();
    }, 1500);
}

function showToast(message, type = 'info') {
    const toast = document.createElement('div');
    toast.className = `alert alert-${type} alert-dismissible fade show position-fixed`;
    toast.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
    toast.innerHTML = `
        ${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;
    
    document.body.appendChild(toast);
    
    setTimeout(() => {
        if (toast.parentNode) {
            toast.remove();
        }
    }, 3000);
}

window.addEventListener('resize', () => {
    Chart.instances.forEach(chart => {
        chart.resize();
    });
});
</script>

<%- include('../partials/footer') %>